<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.426">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Leon C. Reteig">

<title>SLE-autoantibody-prediction - Models for discriminating SLE patients from healthy controls (Blood Bank Donors)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link id="quarto-text-highlighting-styles" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Models for discriminating SLE patients from healthy controls (Blood Bank Donors)</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../" class="sidebar-logo-link">
      <img src="https://cdn.worldvectorlogo.com/logos/umc-utrecht-1.svg" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">SLE-autoantibody-prediction</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/preprocess.html" class="sidebar-item-text sidebar-link">Preprocessing</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/projection.html" class="sidebar-item-text sidebar-link">Dimensionality reduction / projections</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Prediction</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/Main Results.html" class="sidebar-item-text sidebar-link">Main Results</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/SLE Versus BBD.html" class="sidebar-item-text sidebar-link active">Models for discriminating SLE patients from healthy controls (Blood Bank Donors)</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/SLE Versus nonIMID.html" class="sidebar-item-text sidebar-link">Models for discriminating SLE patients from nonIMID controls</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/Nefritis Versus non-nefritis.html" class="sidebar-item-text sidebar-link">Predict whether an SLE patient has nefritis or not</a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#logistic-regression-only-dsdna" id="toc-logistic-regression-only-dsdna" class="nav-link" data-scroll-target="#logistic-regression-only-dsdna">Logistic regression: Only dsDNA</a>
  <ul class="collapse">
  <li><a href="#test-on-other-groups" id="toc-test-on-other-groups" class="nav-link" data-scroll-target="#test-on-other-groups">Test on other groups</a></li>
  </ul></li>
  <li><a href="#logistic-regression-without-dsdna" id="toc-logistic-regression-without-dsdna" class="nav-link" data-scroll-target="#logistic-regression-without-dsdna">Logistic regression without dsDNA</a></li>
  <li><a href="#logistic-regression-with-all-features" id="toc-logistic-regression-with-all-features" class="nav-link" data-scroll-target="#logistic-regression-with-all-features">Logistic regression with all features</a>
  <ul class="collapse">
  <li><a href="#without-scaling" id="toc-without-scaling" class="nav-link" data-scroll-target="#without-scaling">Without scaling:</a></li>
  <li><a href="#with-standardization" id="toc-with-standardization" class="nav-link" data-scroll-target="#with-standardization">With standardization:</a></li>
  <li><a href="#with-standardization-box-cox" id="toc-with-standardization-box-cox" class="nav-link" data-scroll-target="#with-standardization-box-cox">With standardization + Box-Cox:</a></li>
  </ul></li>
  <li><a href="#penalized-logistic-regression" id="toc-penalized-logistic-regression" class="nav-link" data-scroll-target="#penalized-logistic-regression">Penalized logistic regression</a>
  <ul class="collapse">
  <li><a href="#ridge" id="toc-ridge" class="nav-link" data-scroll-target="#ridge">Ridge</a></li>
  <li><a href="#lasso" id="toc-lasso" class="nav-link" data-scroll-target="#lasso">LASSO</a>
  <ul class="collapse">
  <li><a href="#stability-selection" id="toc-stability-selection" class="nav-link" data-scroll-target="#stability-selection">Stability selection</a></li>
  <li><a href="#test-on-other-groups-1" id="toc-test-on-other-groups-1" class="nav-link" data-scroll-target="#test-on-other-groups-1">Test on other groups</a></li>
  </ul></li>
  <li><a href="#elastic-net" id="toc-elastic-net" class="nav-link" data-scroll-target="#elastic-net">Elastic net</a></li>
  <li><a href="#huber" id="toc-huber" class="nav-link" data-scroll-target="#huber">Huber</a></li>
  </ul></li>
  <li><a href="#random-forest" id="toc-random-forest" class="nav-link" data-scroll-target="#random-forest">Random Forest</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/umcu/SLE-autoantibody-prediction/blob/main/notebooks/SLE Versus BBD.ipynb" class="toc-action">View source</a></p><p><a href="https://github.com/umcu/SLE-autoantibody-prediction/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Models for discriminating SLE patients from healthy controls (Blood Bank Donors)</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Leon C. Reteig 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University Medical Center Utrecht
          </p>
      </div>
    </div>



<div class="quarto-title-meta">

      
    
  </div>
  

</header>

<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Citation
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>This notebook contains analyses for the following project:</strong></p>
<p>Brunekreef TE, Reteig LC, Limper M, Haitjema S, Dias J, Mathsson-Alm L, van Laar JM, Otten HG. <a href="https://doi.org/10.1016/j.humimm.2022.03.010">Microarray analysis of autoantibodies can identify future Systemic Lupus Erythematosus patients</a>. Human Immunology. 2022 Apr 11. doi:10.1016/j.humimm.2022.03.010</p>
</div>
</div>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> feather</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, RobustScaler, PowerTransformer</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RepeatedStratifiedKFold, cross_val_score, GridSearchCV</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.dummy <span class="im">import</span> DummyClassifier</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression, SGDClassifier</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> stability_selection <span class="im">import</span> StabilitySelection, plot_stability_path</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> joblib <span class="im">import</span> parallel_backend</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sle.regression <span class="im">import</span> coef_from_sm, coef_plot, make_coef_tbl</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sle.modeling <span class="im">import</span> generate_data, prep_data, eval_model, calc_roc_cv, plot_roc_cv</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sle.penalization <span class="im">import</span> regularization_range, choose_C, regularization_path, plot_regularization_path, coef_plots_regularized</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/lcreteig/miniconda3/envs/SLE/lib/python3.7/site-packages/sklearn/utils/deprecation.py:143: FutureWarning: The sklearn.linear_model.base module is  deprecated in version 0.22 and will be removed in version 0.24. The corresponding classes / functions should instead be imported from sklearn.linear_model. Anything that cannot be imported from sklearn.linear_model is now part of the private API.
  warnings.warn(message, FutureWarning)</code></pre>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Running the code without the original data
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to run the code but don’t have access to the data, run the following instead to generate some synthetic data:</p>
</div>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data_all <span class="op">=</span> generate_data(<span class="st">'imid'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>X_test_df <span class="op">=</span> generate_data(<span class="st">'rest'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="3">
<details>
<summary>Code for loading original data</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data_dir <span class="op">=</span> os.path.join(<span class="st">'..'</span>, <span class="st">'data'</span>, <span class="st">'processed'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>data_all <span class="op">=</span> feather.read_dataframe(os.path.join(data_dir, <span class="st">'imid.feather'</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>X_test_df <span class="op">=</span> feather.read_dataframe(os.path.join(data_dir,<span class="st">'rest.feather'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X, y <span class="op">=</span> prep_data(data_all, <span class="st">'SLE'</span>, <span class="st">'BBD'</span>, drop_cols <span class="op">=</span> [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dsDNA <span class="op">=</span> X.dsDNA2.values.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="co"># only dsDNA from chip as a vector</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>cv <span class="op">=</span> RepeatedStratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, n_repeats<span class="op">=</span><span class="dv">5</span>, random_state<span class="op">=</span><span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Dummy classifier</strong></p>
<p>Accuracy for dummy classifier:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dummy_clf <span class="op">=</span> DummyClassifier(random_state <span class="op">=</span> <span class="dv">40</span>, strategy <span class="op">=</span> <span class="st">'most_frequent'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dummy_clf.fit(X, y)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>dummy_clf.predict(X),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>dummy_clf.score(X,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>0.5722748815165877</code></pre>
</div>
</div>
</section>
<section id="logistic-regression-only-dsdna" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-only-dsdna">Logistic regression: Only dsDNA</h2>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> LogisticRegression(penalty <span class="op">=</span> <span class="st">'none'</span>, max_iter <span class="op">=</span> <span class="dv">10000</span>) <span class="co"># increase iterations for solver to converge</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>lr_dsDNA <span class="op">=</span> clf.fit(dsDNA, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(clf, dsDNA, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.7956906204723647</code></pre>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>logreg_dsDNA <span class="op">=</span> sm.Logit(y,sm.add_constant(dsDNA)).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.511833
         Iterations 12</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>np.exp(coef_from_sm(logreg_dsDNA))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ci_lower</th>
      <th>ci_upper</th>
      <th>beta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>x1</th>
      <td>1.015272</td>
      <td>1.024399</td>
      <td>1.019825</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="test-on-other-groups" class="level3">
<h3 class="anchored" data-anchor-id="test-on-other-groups">Test on other groups</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">pre-SLE (vs.&nbsp;rest)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">LLD (vs.&nbsp;rest)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">IMID (vs.&nbsp;nonIMID)</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(X_test_df, <span class="st">'preSLE'</span>, <span class="st">'rest_large'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>eval_model(lr_dsDNA, X_test.dsDNA2.values.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), y_test, <span class="st">'preSLE'</span>, <span class="st">'rest_large'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

  rest_large       0.98      0.79      0.87       462
      preSLE       0.10      0.65      0.17        17

    accuracy                           0.78       479
   macro avg       0.54      0.72      0.52       479
weighted avg       0.95      0.78      0.85       479

N.B.: "recall" = sensitivity for the group in this row (e.g. preSLE); specificity for the other group (rest_large)
N.B.: "precision" = PPV for the group in this row (e.g. preSLE); NPV for the other group (rest_large)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-12-output-3.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(X_test_df, <span class="st">'LLD'</span>, <span class="st">'rest_large'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>eval_model(lr_dsDNA, X_test.dsDNA2.values.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), y_test, <span class="st">'LLD'</span>, <span class="st">'rest_large'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

  rest_large       0.96      0.79      0.86       462
         LLD       0.12      0.46      0.19        28

    accuracy                           0.77       490
   macro avg       0.54      0.62      0.52       490
weighted avg       0.91      0.77      0.83       490

N.B.: "recall" = sensitivity for the group in this row (e.g. LLD); specificity for the other group (rest_large)
N.B.: "precision" = PPV for the group in this row (e.g. LLD); NPV for the other group (rest_large)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-13-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-13-output-3.png" class="img-fluid"></p>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(data_all, <span class="st">'IMID'</span>, <span class="st">'nonIMID'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>eval_model(lr_dsDNA, X_test.dsDNA2.values.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>), y_test, <span class="st">'IMID'</span>, <span class="st">'nonIMID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

     nonIMID       0.42      0.77      0.55       218
        IMID       0.70      0.34      0.46       346

    accuracy                           0.51       564
   macro avg       0.56      0.55      0.50       564
weighted avg       0.59      0.51      0.49       564

N.B.: "recall" = sensitivity for the group in this row (e.g. IMID); specificity for the other group (nonIMID)
N.B.: "precision" = PPV for the group in this row (e.g. IMID); NPV for the other group (nonIMID)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-14-output-3.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="logistic-regression-without-dsdna" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-without-dsdna">Logistic regression without dsDNA</h2>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>no_dsDNA <span class="op">=</span> X.drop(columns<span class="op">=</span><span class="st">'dsDNA2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(clf, no_dsDNA, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.9007552888337073</code></pre>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>logreg_no_dsDNA <span class="op">=</span> sm.Logit(y,sm.add_constant(no_dsDNA)).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.258118
         Iterations 11</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>coefs_no_dsDNA <span class="op">=</span> coef_from_sm(logreg_no_dsDNA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>coef_plot(coefs_no_dsDNA, OR<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>When dropping <code>dsDNA</code>, <code>CpGmot</code> switches sign, and is now just barely significant (see below)</p>
</section>
<section id="logistic-regression-with-all-features" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-with-all-features">Logistic regression with all features</h2>
<p>Variance inflation factors</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df_cor <span class="op">=</span> X.corr()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>vifs <span class="op">=</span> pd.Series(np.linalg.inv(df_cor.values).diagonal(), index<span class="op">=</span>df_cor.index)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>vifs[vifs <span class="op">&gt;</span> <span class="dv">2</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>RipP2           58.668002
RipP1           21.379985
RipP0           19.101134
Enolasearg      11.417301
CCP1arg          7.781867
SmBB             7.486631
SMP              6.739662
EphB2            5.293658
Enolasecit       5.076042
RipP0peptide     4.229254
Ro60             4.180351
Ro52             4.064606
Nucleosome       3.890488
RNPA             3.814536
H2Bp             3.617355
H2Bpac           3.566022
H4p              3.216518
dsDNA2           3.054496
RNP70            3.052853
RNPC             2.869649
CpGmot           2.847054
H4pac            2.793631
Histones         2.727817
CCP1cit          2.692775
dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">13</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(df_cor, vmin<span class="op">=</span><span class="fl">0.75</span>, square <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fa2d6eb4810&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-22-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Work down the list of VIFs. Whenever a correlation exceeds threshold, discard feature with highest VIF:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set without correlations above .9</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>X_nocor90 <span class="op">=</span> X.drop(columns <span class="op">=</span> [</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RipP2'</span>, <span class="co"># with RipP1 and RipP0</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Enolasearg'</span> <span class="co"># with CCP1arg</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set without correlations above .85</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>X_nocor85 <span class="op">=</span> X.drop(columns <span class="op">=</span> [</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RipP2'</span>, <span class="co"># with RipP1 and RipP0</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Enolasearg'</span>, <span class="co"># with CCP1arg, EphB2</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SmBB'</span> <span class="co"># with SMP</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set without correlations above .8</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>X_nocor80 <span class="op">=</span> X.drop(columns <span class="op">=</span> [</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RipP2'</span>, <span class="st">'RipP1'</span>, <span class="co"># with RipP0</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Enolasearg'</span>, <span class="co"># with CCP1arg, EphB2, Enolasecit, RipP0peptide</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CCP1arg'</span>, <span class="co"># with EphB2</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SmBB'</span>, <span class="co"># with SMP</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Ro60'</span>, <span class="co"># with Ro52</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'H2Bp'</span> <span class="co"># with H2Bpac</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="without-scaling" class="level3">
<h3 class="anchored" data-anchor-id="without-scaling">Without scaling:</h3>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(clf, X, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.9111973993393901</code></pre>
</div>
</div>
<p>Repeat with <code>statsmodels</code>, to get coefs / odds ratios and CIs:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> sm.Logit(y,sm.add_constant(X)).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.234249
         Iterations 13</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>logreg.summary().tables[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<table class="simpletable">
<caption>Logit Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>         <td>Class</td>      <th>  No. Observations:  </th>   <td>   844</td>  
</tr>
<tr>
  <th>Model:</th>                 <td>Logit</td>      <th>  Df Residuals:      </th>   <td>   786</td>  
</tr>
<tr>
  <th>Method:</th>                 <td>MLE</td>       <th>  Df Model:          </th>   <td>    57</td>  
</tr>
<tr>
  <th>Date:</th>            <td>Fri, 20 May 2022</td> <th>  Pseudo R-squ.:     </th>   <td>0.6569</td>  
</tr>
<tr>
  <th>Time:</th>                <td>10:33:04</td>     <th>  Log-Likelihood:    </th>  <td> -197.71</td> 
</tr>
<tr>
  <th>converged:</th>             <td>True</td>       <th>  LL-Null:           </th>  <td> -576.17</td> 
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>  LLR p-value:       </th> <td>6.396e-123</td>
</tr>
</tbody></table>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>pd.read_html(logreg.summary().tables[<span class="dv">1</span>].as_html(), header<span class="op">=</span><span class="dv">0</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>z</th>
      <th>P&gt;|z|</th>
      <th>[0.025</th>
      <th>0.975]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>const</th>
      <td>-1.517100</td>
      <td>0.462000</td>
      <td>-3.287</td>
      <td>0.001</td>
      <td>-2.422000</td>
      <td>-0.612000</td>
    </tr>
    <tr>
      <th>Actinin</th>
      <td>0.000062</td>
      <td>0.001000</td>
      <td>0.123</td>
      <td>0.902</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>ASCA</th>
      <td>0.000011</td>
      <td>0.000058</td>
      <td>0.182</td>
      <td>0.856</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Beta2GP1</th>
      <td>0.000028</td>
      <td>0.000053</td>
      <td>0.535</td>
      <td>0.593</td>
      <td>-0.000075</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>C1q</th>
      <td>-0.000300</td>
      <td>0.001000</td>
      <td>-0.294</td>
      <td>0.769</td>
      <td>-0.002000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>C3b</th>
      <td>-0.001900</td>
      <td>0.001000</td>
      <td>-1.315</td>
      <td>0.189</td>
      <td>-0.005000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>Cardiolipin</th>
      <td>0.000200</td>
      <td>0.000000</td>
      <td>0.753</td>
      <td>0.452</td>
      <td>-0.000000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>CCP1arg</th>
      <td>-0.001100</td>
      <td>0.001000</td>
      <td>-1.256</td>
      <td>0.209</td>
      <td>-0.003000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>CCP1cit</th>
      <td>0.001700</td>
      <td>0.001000</td>
      <td>1.329</td>
      <td>0.184</td>
      <td>-0.001000</td>
      <td>0.004000</td>
    </tr>
    <tr>
      <th>CENP</th>
      <td>0.000039</td>
      <td>0.000054</td>
      <td>0.720</td>
      <td>0.472</td>
      <td>-0.000067</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CMV</th>
      <td>0.000200</td>
      <td>0.000059</td>
      <td>2.743</td>
      <td>0.006</td>
      <td>0.000046</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CollagenII</th>
      <td>-0.002400</td>
      <td>0.001000</td>
      <td>-1.674</td>
      <td>0.094</td>
      <td>-0.005000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>CpGmot</th>
      <td>-0.004600</td>
      <td>0.003000</td>
      <td>-1.383</td>
      <td>0.167</td>
      <td>-0.011000</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>CRP1</th>
      <td>0.001100</td>
      <td>0.002000</td>
      <td>0.635</td>
      <td>0.526</td>
      <td>-0.002000</td>
      <td>0.004000</td>
    </tr>
    <tr>
      <th>DFS70</th>
      <td>-0.000019</td>
      <td>0.000000</td>
      <td>-0.168</td>
      <td>0.867</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>dsDNA2</th>
      <td>0.012600</td>
      <td>0.003000</td>
      <td>4.164</td>
      <td>0.000</td>
      <td>0.007000</td>
      <td>0.019000</td>
    </tr>
    <tr>
      <th>Enolasearg</th>
      <td>-0.000300</td>
      <td>0.001000</td>
      <td>-0.356</td>
      <td>0.722</td>
      <td>-0.002000</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>Enolasecit</th>
      <td>-0.000800</td>
      <td>0.001000</td>
      <td>-1.437</td>
      <td>0.151</td>
      <td>-0.002000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>EphB2</th>
      <td>-0.002600</td>
      <td>0.001000</td>
      <td>-1.900</td>
      <td>0.057</td>
      <td>-0.005000</td>
      <td>0.000084</td>
    </tr>
    <tr>
      <th>FcER</th>
      <td>-0.000600</td>
      <td>0.001000</td>
      <td>-0.626</td>
      <td>0.532</td>
      <td>-0.003000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>Fibrillarin</th>
      <td>-0.000200</td>
      <td>0.000000</td>
      <td>-0.943</td>
      <td>0.346</td>
      <td>-0.001000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Ficolin</th>
      <td>-0.000500</td>
      <td>0.002000</td>
      <td>-0.301</td>
      <td>0.764</td>
      <td>-0.003000</td>
      <td>0.003000</td>
    </tr>
    <tr>
      <th>GAPDH</th>
      <td>-0.000085</td>
      <td>0.000000</td>
      <td>-0.629</td>
      <td>0.529</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>GBM</th>
      <td>-0.001800</td>
      <td>0.001000</td>
      <td>-2.750</td>
      <td>0.006</td>
      <td>-0.003000</td>
      <td>-0.001000</td>
    </tr>
    <tr>
      <th>H2Bp</th>
      <td>-0.000100</td>
      <td>0.000000</td>
      <td>-0.292</td>
      <td>0.770</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>H2Bpac</th>
      <td>0.000400</td>
      <td>0.000000</td>
      <td>0.761</td>
      <td>0.447</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>H4p</th>
      <td>-0.000029</td>
      <td>0.000000</td>
      <td>-0.099</td>
      <td>0.921</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>H4pac</th>
      <td>0.000047</td>
      <td>0.000000</td>
      <td>0.230</td>
      <td>0.818</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Histones</th>
      <td>-0.003600</td>
      <td>0.003000</td>
      <td>-1.304</td>
      <td>0.192</td>
      <td>-0.009000</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>IFNLambda</th>
      <td>0.000100</td>
      <td>0.000000</td>
      <td>0.848</td>
      <td>0.397</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>IFNOmega</th>
      <td>-0.000100</td>
      <td>0.000000</td>
      <td>-0.271</td>
      <td>0.787</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>Jo1</th>
      <td>0.002500</td>
      <td>0.001000</td>
      <td>2.114</td>
      <td>0.034</td>
      <td>0.000000</td>
      <td>0.005000</td>
    </tr>
    <tr>
      <th>Ku</th>
      <td>0.001000</td>
      <td>0.000000</td>
      <td>1.984</td>
      <td>0.047</td>
      <td>0.000012</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>LaSSB</th>
      <td>0.000900</td>
      <td>0.000000</td>
      <td>2.652</td>
      <td>0.008</td>
      <td>0.000000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>MBL2</th>
      <td>-0.000032</td>
      <td>0.001000</td>
      <td>-0.061</td>
      <td>0.951</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>Mi2</th>
      <td>0.000400</td>
      <td>0.000000</td>
      <td>0.811</td>
      <td>0.417</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>Nucleosome</th>
      <td>-0.000200</td>
      <td>0.001000</td>
      <td>-0.197</td>
      <td>0.844</td>
      <td>-0.002000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>PCNA</th>
      <td>-0.002100</td>
      <td>0.002000</td>
      <td>-1.037</td>
      <td>0.300</td>
      <td>-0.006000</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>Pentraxin3</th>
      <td>0.000800</td>
      <td>0.000000</td>
      <td>2.115</td>
      <td>0.034</td>
      <td>0.000060</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>PmScl100</th>
      <td>0.000090</td>
      <td>0.000065</td>
      <td>1.388</td>
      <td>0.165</td>
      <td>-0.000037</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>RA33</th>
      <td>0.000200</td>
      <td>0.000000</td>
      <td>0.572</td>
      <td>0.567</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>RipP0</th>
      <td>0.000500</td>
      <td>0.002000</td>
      <td>0.270</td>
      <td>0.787</td>
      <td>-0.003000</td>
      <td>0.004000</td>
    </tr>
    <tr>
      <th>RipP0peptide</th>
      <td>-0.000600</td>
      <td>0.000000</td>
      <td>-1.935</td>
      <td>0.053</td>
      <td>-0.001000</td>
      <td>0.000008</td>
    </tr>
    <tr>
      <th>RipP1</th>
      <td>0.000300</td>
      <td>0.001000</td>
      <td>0.265</td>
      <td>0.791</td>
      <td>-0.002000</td>
      <td>0.002000</td>
    </tr>
    <tr>
      <th>RipP2</th>
      <td>0.002300</td>
      <td>0.001000</td>
      <td>1.840</td>
      <td>0.066</td>
      <td>-0.000000</td>
      <td>0.005000</td>
    </tr>
    <tr>
      <th>RNAPolIII</th>
      <td>-0.000300</td>
      <td>0.000000</td>
      <td>-1.691</td>
      <td>0.091</td>
      <td>-0.001000</td>
      <td>0.000051</td>
    </tr>
    <tr>
      <th>RNP70</th>
      <td>0.000100</td>
      <td>0.000000</td>
      <td>0.328</td>
      <td>0.743</td>
      <td>-0.001000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>RNPA</th>
      <td>0.000400</td>
      <td>0.000000</td>
      <td>2.512</td>
      <td>0.012</td>
      <td>0.000088</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>RNPC</th>
      <td>-0.000400</td>
      <td>0.000000</td>
      <td>-1.522</td>
      <td>0.128</td>
      <td>-0.001000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Ro52</th>
      <td>0.000007</td>
      <td>0.000071</td>
      <td>0.094</td>
      <td>0.925</td>
      <td>-0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Ro60</th>
      <td>0.000600</td>
      <td>0.000000</td>
      <td>4.675</td>
      <td>0.000</td>
      <td>0.000000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>RPP25ThTo</th>
      <td>-0.001600</td>
      <td>0.000000</td>
      <td>-3.962</td>
      <td>0.000</td>
      <td>-0.002000</td>
      <td>-0.001000</td>
    </tr>
    <tr>
      <th>Scl70</th>
      <td>-0.000300</td>
      <td>0.000000</td>
      <td>-1.295</td>
      <td>0.195</td>
      <td>-0.001000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>SmBB</th>
      <td>0.000300</td>
      <td>0.000000</td>
      <td>1.679</td>
      <td>0.093</td>
      <td>-0.000049</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>SMP</th>
      <td>0.000300</td>
      <td>0.000000</td>
      <td>0.937</td>
      <td>0.349</td>
      <td>-0.000000</td>
      <td>0.001000</td>
    </tr>
    <tr>
      <th>TIF1gamma</th>
      <td>0.002100</td>
      <td>0.001000</td>
      <td>2.663</td>
      <td>0.008</td>
      <td>0.001000</td>
      <td>0.004000</td>
    </tr>
    <tr>
      <th>TPO</th>
      <td>0.000014</td>
      <td>0.000018</td>
      <td>0.790</td>
      <td>0.430</td>
      <td>-0.000021</td>
      <td>0.000049</td>
    </tr>
    <tr>
      <th>tTG</th>
      <td>-0.001500</td>
      <td>0.001000</td>
      <td>-2.590</td>
      <td>0.010</td>
      <td>-0.003000</td>
      <td>-0.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Sorted coefficients with CIs:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> coef_from_sm(logreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot Odds ratios:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>coef_plot(np.exp(coefs), OR<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="with-standardization" class="level3">
<h3 class="anchored" data-anchor-id="with-standardization">With standardization:</h3>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>pipe_sc <span class="op">=</span> Pipeline([</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'scale'</span>, RobustScaler()), <span class="co"># try RobustScaler because the data is highly skewed and have outliers</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(pipe_sc, X, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>0.9117359345823722</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>scale<span class="op">=</span>RobustScaler()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>X_sc <span class="op">=</span> pd.DataFrame(scale.fit_transform(X), index<span class="op">=</span>X.index, columns<span class="op">=</span>X.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>logreg_sc <span class="op">=</span> sm.Logit(y,sm.add_constant(X_sc)).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.234249
         Iterations 13</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>coefs_sc <span class="op">=</span> coef_from_sm(logreg_sc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>coef_plot(coefs_sc, OR<span class="op">=</span><span class="va">False</span>) <span class="co"># plotting ORs here is not feasible as Ro60 is so large</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This makes <code>Ro60</code> the highest-weighted feature, cf.&nbsp;XGBoost</p>
</section>
<section id="with-standardization-box-cox" class="level3">
<h3 class="anchored" data-anchor-id="with-standardization-box-cox">With standardization + Box-Cox:</h3>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>Xp1 <span class="op">=</span> X <span class="op">+</span> <span class="dv">1</span> <span class="co"># Some values are between -1 and 0. Because negative fluorescence isn't possible, and Box-Cox requires strictly positive values, add ofset</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>trf <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'box-cox'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pipe_trf <span class="op">=</span> Pipeline([</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'transform'</span>, trf),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(pipe_trf, Xp1, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.9692078370914341</code></pre>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>X_trf <span class="op">=</span> pd.DataFrame(trf.fit_transform(Xp1), index<span class="op">=</span>X.index, columns<span class="op">=</span>X.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>logreg_trf <span class="op">=</span> sm.Logit(y,sm.add_constant(X_trf)).fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization terminated successfully.
         Current function value: 0.089226
         Iterations 11</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>logreg_trf.summary().tables[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">

<table class="simpletable">
<caption>Logit Regression Results</caption>
<tbody><tr>
  <th>Dep. Variable:</th>         <td>Class</td>      <th>  No. Observations:  </th>   <td>   844</td>  
</tr>
<tr>
  <th>Model:</th>                 <td>Logit</td>      <th>  Df Residuals:      </th>   <td>   786</td>  
</tr>
<tr>
  <th>Method:</th>                 <td>MLE</td>       <th>  Df Model:          </th>   <td>    57</td>  
</tr>
<tr>
  <th>Date:</th>            <td>Fri, 20 May 2022</td> <th>  Pseudo R-squ.:     </th>   <td>0.8693</td>  
</tr>
<tr>
  <th>Time:</th>                <td>10:33:16</td>     <th>  Log-Likelihood:    </th>  <td> -75.307</td> 
</tr>
<tr>
  <th>converged:</th>             <td>True</td>       <th>  LL-Null:           </th>  <td> -576.17</td> 
</tr>
<tr>
  <th>Covariance Type:</th>     <td>nonrobust</td>    <th>  LLR p-value:       </th> <td>9.702e-173</td>
</tr>
</tbody></table>
</div>
</div>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pd.read_html(logreg_trf.summary().tables[<span class="dv">1</span>].as_html(), header<span class="op">=</span><span class="dv">0</span>, index_col<span class="op">=</span><span class="dv">0</span>)[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>coef</th>
      <th>std err</th>
      <th>z</th>
      <th>P&gt;|z|</th>
      <th>[0.025</th>
      <th>0.975]</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>const</th>
      <td>4.5543</td>
      <td>0.743</td>
      <td>6.130</td>
      <td>0.000</td>
      <td>3.098</td>
      <td>6.011</td>
    </tr>
    <tr>
      <th>Actinin</th>
      <td>-0.8145</td>
      <td>0.400</td>
      <td>-2.038</td>
      <td>0.042</td>
      <td>-1.598</td>
      <td>-0.031</td>
    </tr>
    <tr>
      <th>ASCA</th>
      <td>-0.2700</td>
      <td>0.301</td>
      <td>-0.896</td>
      <td>0.370</td>
      <td>-0.861</td>
      <td>0.321</td>
    </tr>
    <tr>
      <th>Beta2GP1</th>
      <td>-0.4904</td>
      <td>0.309</td>
      <td>-1.589</td>
      <td>0.112</td>
      <td>-1.095</td>
      <td>0.114</td>
    </tr>
    <tr>
      <th>C1q</th>
      <td>-0.4621</td>
      <td>0.425</td>
      <td>-1.088</td>
      <td>0.277</td>
      <td>-1.294</td>
      <td>0.370</td>
    </tr>
    <tr>
      <th>C3b</th>
      <td>-0.9447</td>
      <td>0.456</td>
      <td>-2.072</td>
      <td>0.038</td>
      <td>-1.838</td>
      <td>-0.051</td>
    </tr>
    <tr>
      <th>Cardiolipin</th>
      <td>-0.2555</td>
      <td>0.286</td>
      <td>-0.893</td>
      <td>0.372</td>
      <td>-0.816</td>
      <td>0.305</td>
    </tr>
    <tr>
      <th>CCP1arg</th>
      <td>-1.0606</td>
      <td>0.446</td>
      <td>-2.376</td>
      <td>0.018</td>
      <td>-1.936</td>
      <td>-0.186</td>
    </tr>
    <tr>
      <th>CCP1cit</th>
      <td>0.1408</td>
      <td>0.515</td>
      <td>0.273</td>
      <td>0.785</td>
      <td>-0.869</td>
      <td>1.150</td>
    </tr>
    <tr>
      <th>CENP</th>
      <td>-0.1280</td>
      <td>0.269</td>
      <td>-0.476</td>
      <td>0.634</td>
      <td>-0.655</td>
      <td>0.399</td>
    </tr>
    <tr>
      <th>CMV</th>
      <td>-0.2295</td>
      <td>0.295</td>
      <td>-0.779</td>
      <td>0.436</td>
      <td>-0.807</td>
      <td>0.348</td>
    </tr>
    <tr>
      <th>CollagenII</th>
      <td>0.7417</td>
      <td>0.326</td>
      <td>2.275</td>
      <td>0.023</td>
      <td>0.103</td>
      <td>1.381</td>
    </tr>
    <tr>
      <th>CpGmot</th>
      <td>0.0019</td>
      <td>0.711</td>
      <td>0.003</td>
      <td>0.998</td>
      <td>-1.392</td>
      <td>1.395</td>
    </tr>
    <tr>
      <th>CRP1</th>
      <td>0.3503</td>
      <td>0.441</td>
      <td>0.795</td>
      <td>0.427</td>
      <td>-0.513</td>
      <td>1.214</td>
    </tr>
    <tr>
      <th>DFS70</th>
      <td>-0.1203</td>
      <td>0.341</td>
      <td>-0.353</td>
      <td>0.724</td>
      <td>-0.788</td>
      <td>0.548</td>
    </tr>
    <tr>
      <th>dsDNA2</th>
      <td>5.3738</td>
      <td>1.051</td>
      <td>5.115</td>
      <td>0.000</td>
      <td>3.315</td>
      <td>7.433</td>
    </tr>
    <tr>
      <th>Enolasearg</th>
      <td>0.5916</td>
      <td>0.370</td>
      <td>1.598</td>
      <td>0.110</td>
      <td>-0.134</td>
      <td>1.317</td>
    </tr>
    <tr>
      <th>Enolasecit</th>
      <td>-0.5567</td>
      <td>0.569</td>
      <td>-0.978</td>
      <td>0.328</td>
      <td>-1.672</td>
      <td>0.558</td>
    </tr>
    <tr>
      <th>EphB2</th>
      <td>-0.0102</td>
      <td>0.391</td>
      <td>-0.026</td>
      <td>0.979</td>
      <td>-0.777</td>
      <td>0.756</td>
    </tr>
    <tr>
      <th>FcER</th>
      <td>0.1500</td>
      <td>0.294</td>
      <td>0.510</td>
      <td>0.610</td>
      <td>-0.427</td>
      <td>0.727</td>
    </tr>
    <tr>
      <th>Fibrillarin</th>
      <td>-0.2806</td>
      <td>0.306</td>
      <td>-0.917</td>
      <td>0.359</td>
      <td>-0.880</td>
      <td>0.319</td>
    </tr>
    <tr>
      <th>Ficolin</th>
      <td>0.8266</td>
      <td>0.368</td>
      <td>2.245</td>
      <td>0.025</td>
      <td>0.105</td>
      <td>1.548</td>
    </tr>
    <tr>
      <th>GAPDH</th>
      <td>-0.3229</td>
      <td>0.321</td>
      <td>-1.007</td>
      <td>0.314</td>
      <td>-0.951</td>
      <td>0.306</td>
    </tr>
    <tr>
      <th>GBM</th>
      <td>-1.2108</td>
      <td>0.378</td>
      <td>-3.206</td>
      <td>0.001</td>
      <td>-1.951</td>
      <td>-0.470</td>
    </tr>
    <tr>
      <th>H2Bp</th>
      <td>0.5583</td>
      <td>0.548</td>
      <td>1.018</td>
      <td>0.309</td>
      <td>-0.516</td>
      <td>1.633</td>
    </tr>
    <tr>
      <th>H2Bpac</th>
      <td>0.0365</td>
      <td>0.509</td>
      <td>0.072</td>
      <td>0.943</td>
      <td>-0.962</td>
      <td>1.035</td>
    </tr>
    <tr>
      <th>H4p</th>
      <td>-1.0386</td>
      <td>0.481</td>
      <td>-2.161</td>
      <td>0.031</td>
      <td>-1.981</td>
      <td>-0.097</td>
    </tr>
    <tr>
      <th>H4pac</th>
      <td>0.1825</td>
      <td>0.369</td>
      <td>0.495</td>
      <td>0.620</td>
      <td>-0.540</td>
      <td>0.905</td>
    </tr>
    <tr>
      <th>Histones</th>
      <td>-2.0035</td>
      <td>0.514</td>
      <td>-3.896</td>
      <td>0.000</td>
      <td>-3.011</td>
      <td>-0.996</td>
    </tr>
    <tr>
      <th>IFNLambda</th>
      <td>0.5550</td>
      <td>0.336</td>
      <td>1.650</td>
      <td>0.099</td>
      <td>-0.104</td>
      <td>1.214</td>
    </tr>
    <tr>
      <th>IFNOmega</th>
      <td>0.2533</td>
      <td>0.269</td>
      <td>0.941</td>
      <td>0.347</td>
      <td>-0.274</td>
      <td>0.781</td>
    </tr>
    <tr>
      <th>Jo1</th>
      <td>-0.0686</td>
      <td>0.352</td>
      <td>-0.195</td>
      <td>0.845</td>
      <td>-0.758</td>
      <td>0.621</td>
    </tr>
    <tr>
      <th>Ku</th>
      <td>-0.3340</td>
      <td>0.353</td>
      <td>-0.945</td>
      <td>0.344</td>
      <td>-1.027</td>
      <td>0.359</td>
    </tr>
    <tr>
      <th>LaSSB</th>
      <td>2.3330</td>
      <td>0.495</td>
      <td>4.713</td>
      <td>0.000</td>
      <td>1.363</td>
      <td>3.303</td>
    </tr>
    <tr>
      <th>MBL2</th>
      <td>0.0647</td>
      <td>0.318</td>
      <td>0.203</td>
      <td>0.839</td>
      <td>-0.559</td>
      <td>0.689</td>
    </tr>
    <tr>
      <th>Mi2</th>
      <td>0.2443</td>
      <td>0.320</td>
      <td>0.762</td>
      <td>0.446</td>
      <td>-0.384</td>
      <td>0.872</td>
    </tr>
    <tr>
      <th>Nucleosome</th>
      <td>0.0982</td>
      <td>0.619</td>
      <td>0.159</td>
      <td>0.874</td>
      <td>-1.116</td>
      <td>1.312</td>
    </tr>
    <tr>
      <th>PCNA</th>
      <td>-0.1289</td>
      <td>0.498</td>
      <td>-0.259</td>
      <td>0.796</td>
      <td>-1.105</td>
      <td>0.847</td>
    </tr>
    <tr>
      <th>Pentraxin3</th>
      <td>1.0234</td>
      <td>0.355</td>
      <td>2.884</td>
      <td>0.004</td>
      <td>0.328</td>
      <td>1.719</td>
    </tr>
    <tr>
      <th>PmScl100</th>
      <td>0.1213</td>
      <td>0.286</td>
      <td>0.425</td>
      <td>0.671</td>
      <td>-0.439</td>
      <td>0.681</td>
    </tr>
    <tr>
      <th>RA33</th>
      <td>1.1406</td>
      <td>0.439</td>
      <td>2.601</td>
      <td>0.009</td>
      <td>0.281</td>
      <td>2.000</td>
    </tr>
    <tr>
      <th>RipP0</th>
      <td>0.0648</td>
      <td>0.446</td>
      <td>0.145</td>
      <td>0.884</td>
      <td>-0.809</td>
      <td>0.938</td>
    </tr>
    <tr>
      <th>RipP0peptide</th>
      <td>-2.9943</td>
      <td>0.597</td>
      <td>-5.018</td>
      <td>0.000</td>
      <td>-4.164</td>
      <td>-1.825</td>
    </tr>
    <tr>
      <th>RipP1</th>
      <td>0.4435</td>
      <td>0.678</td>
      <td>0.654</td>
      <td>0.513</td>
      <td>-0.886</td>
      <td>1.773</td>
    </tr>
    <tr>
      <th>RipP2</th>
      <td>1.5795</td>
      <td>0.566</td>
      <td>2.791</td>
      <td>0.005</td>
      <td>0.470</td>
      <td>2.689</td>
    </tr>
    <tr>
      <th>RNAPolIII</th>
      <td>-0.0588</td>
      <td>0.302</td>
      <td>-0.195</td>
      <td>0.846</td>
      <td>-0.651</td>
      <td>0.534</td>
    </tr>
    <tr>
      <th>RNP70</th>
      <td>-0.4699</td>
      <td>0.370</td>
      <td>-1.270</td>
      <td>0.204</td>
      <td>-1.195</td>
      <td>0.255</td>
    </tr>
    <tr>
      <th>RNPA</th>
      <td>0.4044</td>
      <td>0.294</td>
      <td>1.374</td>
      <td>0.170</td>
      <td>-0.173</td>
      <td>0.981</td>
    </tr>
    <tr>
      <th>RNPC</th>
      <td>-0.0150</td>
      <td>0.350</td>
      <td>-0.043</td>
      <td>0.966</td>
      <td>-0.700</td>
      <td>0.670</td>
    </tr>
    <tr>
      <th>Ro52</th>
      <td>0.9610</td>
      <td>0.478</td>
      <td>2.011</td>
      <td>0.044</td>
      <td>0.025</td>
      <td>1.897</td>
    </tr>
    <tr>
      <th>Ro60</th>
      <td>2.2896</td>
      <td>0.535</td>
      <td>4.281</td>
      <td>0.000</td>
      <td>1.241</td>
      <td>3.338</td>
    </tr>
    <tr>
      <th>RPP25ThTo</th>
      <td>-0.3136</td>
      <td>0.247</td>
      <td>-1.268</td>
      <td>0.205</td>
      <td>-0.798</td>
      <td>0.171</td>
    </tr>
    <tr>
      <th>Scl70</th>
      <td>-0.9654</td>
      <td>0.345</td>
      <td>-2.802</td>
      <td>0.005</td>
      <td>-1.641</td>
      <td>-0.290</td>
    </tr>
    <tr>
      <th>SmBB</th>
      <td>1.2639</td>
      <td>0.421</td>
      <td>3.001</td>
      <td>0.003</td>
      <td>0.438</td>
      <td>2.089</td>
    </tr>
    <tr>
      <th>SMP</th>
      <td>-0.7764</td>
      <td>0.336</td>
      <td>-2.307</td>
      <td>0.021</td>
      <td>-1.436</td>
      <td>-0.117</td>
    </tr>
    <tr>
      <th>TIF1gamma</th>
      <td>0.7880</td>
      <td>0.352</td>
      <td>2.237</td>
      <td>0.025</td>
      <td>0.098</td>
      <td>1.479</td>
    </tr>
    <tr>
      <th>TPO</th>
      <td>0.3571</td>
      <td>0.277</td>
      <td>1.291</td>
      <td>0.197</td>
      <td>-0.185</td>
      <td>0.899</td>
    </tr>
    <tr>
      <th>tTG</th>
      <td>-1.8544</td>
      <td>0.399</td>
      <td>-4.649</td>
      <td>0.000</td>
      <td>-2.636</td>
      <td>-1.073</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>coefs_trf <span class="op">=</span> coef_from_sm(logreg_trf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>coef_plot(coefs_trf, OR<span class="op">=</span><span class="va">False</span>) <span class="co"># plotting ORs here is not feasible as dsDNA is so large</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-46-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Note that once normalized in this way, coefficient for <code>CpGmot</code> becomes very small!</p>
</section>
</section>
<section id="penalized-logistic-regression" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="penalized-logistic-regression">Penalized logistic regression</h2>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>trf <span class="op">=</span> PowerTransformer(method<span class="op">=</span><span class="st">'box-cox'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="ridge" class="level3">
<h3 class="anchored" data-anchor-id="ridge">Ridge</h3>
<p>Choose range for regularization:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for ridge, pick alpha close to zero (if zero, max lambda is infinite. pick alpha=1e-3 to get same as glmnet) </span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and widen the range between lambda max and min (epsilon)</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>lambda_min, lambda_max <span class="op">=</span> regularization_range(Xp1,y,trf,alpha<span class="op">=</span><span class="fl">1e-2</span>, epsilon<span class="op">=</span><span class="fl">1e-6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Choose a final value for the regularization parameter with the 1 SE rule (as just choosing the best lambda tends to under-regularize, https://stats.stackexchange.com/questions/138569)</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>clf_ridge <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="st">'l2'</span>, max_iter <span class="op">=</span> <span class="dv">10000</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>Cs_ridge <span class="op">=</span> np.logspace(np.log10(<span class="dv">1</span><span class="op">/</span>lambda_min), np.log10(<span class="dv">1</span><span class="op">/</span>lambda_max), K) <span class="co"># C is inverse of lambda</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'trf'</span>, trf),</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf_ridge)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [{</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__C"</span>: Cs_ridge</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>search_ridge <span class="op">=</span> GridSearchCV(pipe, params, cv <span class="op">=</span> cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>, refit<span class="op">=</span>choose_C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>search_ridge.fit(Xp1,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8min 54s, sys: 13min 30s, total: 22min 24s
Wall time: 6min 10s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="47">
<pre><code>GridSearchCV(cv=RepeatedStratifiedKFold(n_repeats=5, n_splits=5, random_state=40),
             estimator=Pipeline(steps=[('trf',
                                        PowerTransformer(method='box-cox')),
                                       ('clf',
                                        LogisticRegression(max_iter=10000))]),
             param_grid=[{'clf__C': array([3.42342671e+01, 2.97752197e+01, 2.58969676e+01, 2.25238618e+01,
       1.95901063e+01, 1.70384754e+01, 1.48191970e+01, 1.28889818e+01,
       1.12101...
       4.85261892e-04, 4.22056046e-04, 3.67082825e-04, 3.19269921e-04,
       2.77684695e-04, 2.41515987e-04, 2.10058289e-04, 1.82697987e-04,
       1.58901392e-04, 1.38204327e-04, 1.20203076e-04, 1.04546505e-04,
       9.09292187e-05, 7.90855973e-05, 6.87846194e-05, 5.98253541e-05,
       5.20330420e-05, 4.52556864e-05, 3.93610881e-05, 3.42342671e-05])}],
             refit=&lt;function choose_C at 0x7fecee7479e0&gt;, scoring='roc_auc')</code></pre>
</div>
</div>
<p>Best model:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>search_ridge.cv_results_[<span class="st">'mean_test_score'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>0.9784842809330654</code></pre>
</div>
</div>
<p>Score with lambda selected through 1 SE rule:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>search_ridge.cv_results_[<span class="st">'mean_test_score'</span>][search_ridge.best_index_]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>0.9766731818847515</code></pre>
</div>
</div>
<p>Plot coefficients for different levels of regularization:</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>coefs_ridge, nnz_coefs_ridge <span class="op">=</span> regularization_path(Cs_ridge, clf_ridge, X_trf, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>ax1, ax2, ax22 <span class="op">=</span> plot_regularization_path(<span class="dv">1</span><span class="op">/</span>Cs_ridge, coefs_ridge, nnz_coefs_ridge, search_ridge.cv_results_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-54-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>With nested cross-validation:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#np.mean(cross_val_score(search_ridge, Xp1, y, cv=cv, scoring = 'roc_auc'))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lasso" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="lasso">LASSO</h3>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>lambda_min, lambda_max <span class="op">=</span> regularization_range(Xp1,y,trf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>clf_lasso <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="st">'l1'</span>, max_iter <span class="op">=</span> <span class="dv">10000</span>, solver <span class="op">=</span> <span class="st">'liblinear'</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>Cs_lasso <span class="op">=</span> np.logspace(np.log10(<span class="dv">1</span><span class="op">/</span>lambda_min),np.log10(<span class="dv">1</span><span class="op">/</span>lambda_max), K)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Cs_lasso = l1_min_c(trf.fit_transform(Xp1), y, loss='log') * np.logspace(0, 3, 100)</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'trf'</span>, trf),</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf_lasso)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [{</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__C"</span>: Cs_lasso</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>search_lasso <span class="op">=</span> GridSearchCV(pipe, params, cv <span class="op">=</span> cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>, refit<span class="op">=</span>choose_C)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>search_lasso.fit(Xp1,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 8min 31s, sys: 14min 55s, total: 23min 27s
Wall time: 4min 52s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>GridSearchCV(cv=RepeatedStratifiedKFold(n_repeats=5, n_splits=5, random_state=40),
             estimator=Pipeline(steps=[('trf',
                                        PowerTransformer(method='box-cox')),
                                       ('clf',
                                        LogisticRegression(max_iter=10000,
                                                           penalty='l1',
                                                           solver='liblinear'))]),
             param_grid=[{'clf__C': array([3.42342671, 3.19269921, 2.97752197, 2.77684695, 2.58969676,
       2.41515987, 2.25238618, 2.10058289, 1.95901...
       0.02589697, 0.0241516 , 0.02252386, 0.02100583, 0.01959011,
       0.0182698 , 0.01703848, 0.01589014, 0.0148192 , 0.01382043,
       0.01288898, 0.01202031, 0.01121018, 0.01045465, 0.00975004,
       0.00909292, 0.00848009, 0.00790856, 0.00737555, 0.00687846,
       0.00641488, 0.00598254, 0.00557933, 0.0052033 , 0.00485262,
       0.00452557, 0.00422056, 0.00393611, 0.00367083, 0.00342343])}],
             refit=&lt;function choose_C at 0x7fecee7479e0&gt;, scoring='roc_auc')</code></pre>
</div>
</div>
<p>Best model:</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>search_lasso.cv_results_[<span class="st">'mean_test_score'</span>].<span class="bu">max</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>0.9829858422316895</code></pre>
</div>
</div>
<p>Score with lambda selected through 1 SE rule:</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>search_lasso.cv_results_[<span class="st">'mean_test_score'</span>][search_lasso.best_index_]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>0.9813334351642632</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>coefs_lasso, nnz_coefs_lasso <span class="op">=</span> regularization_path(Cs_lasso, clf_lasso, X_trf, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/home/lcreteig/miniconda3/envs/SLE/lib/python3.7/site-packages/sklearn/svm/_base.py:977: ConvergenceWarning: Liblinear failed to converge, increase the number of iterations.
  "the number of iterations.", ConvergenceWarning)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>ax1, ax2, ax22 <span class="op">=</span> plot_regularization_path(<span class="dv">1</span><span class="op">/</span>Cs_lasso, coefs_lasso, nnz_coefs_lasso, search_lasso.cv_results_)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>ax22.set_ylim([<span class="fl">.9</span>, <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>(0.9, 1)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-62-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Plot the coefficients for models with different levels of regularization (= number of features retained). Start with the model with the best CV ROC AUC, and work our way down to include less and less features:</p>
<div class="cell page-columns page-full" data-scrolled="true" data-execution_count="60">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>coef_plots_regularized(coefs_lasso, nnz_coefs_lasso, search_lasso.cv_results_[<span class="st">"mean_test_score"</span>], X.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display column-page">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Although a lambda that leaves 23 features seems best, AUC only really starts to drop at around 15 features.</p>
<p>Non-zero coefficients of the model selected with the 1SE rule:</p>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>coefs_final <span class="op">=</span> (pd.Series(search_lasso.best_estimator_.named_steps.clf.coef_.squeeze(), index <span class="op">=</span> X.columns)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a> .where(<span class="kw">lambda</span> x : x<span class="op">!=</span><span class="dv">0</span>).</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a> dropna()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a> .sort_values())</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>coefs_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>tTG            -0.612562
RipP0peptide   -0.468708
Histones       -0.436773
CCP1arg        -0.321419
GBM            -0.256901
PmScl100        0.016689
RNPA            0.060150
Pentraxin3      0.063666
RipP2           0.073611
TIF1gamma       0.193812
Ro52            0.278128
LaSSB           0.433654
SmBB            0.482324
Ro60            1.093204
dsDNA2          1.113356
dtype: float64</code></pre>
</div>
</div>
<p>Table with all coefficients:</p>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>make_coef_tbl(logreg_trf, search_lasso.best_estimator_.named_steps.clf, X.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>coef_regularized</th>
      <th>coef</th>
      <th>std err</th>
      <th>95%CI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>const</th>
      <td>0.760</td>
      <td>4.554</td>
      <td>0.743</td>
      <td>3.098, 6.011</td>
    </tr>
    <tr>
      <th>Actinin</th>
      <td>0.000</td>
      <td>-0.814</td>
      <td>0.400</td>
      <td>-1.598, -0.031</td>
    </tr>
    <tr>
      <th>ASCA</th>
      <td>0.000</td>
      <td>-0.270</td>
      <td>0.301</td>
      <td>-0.861, 0.321</td>
    </tr>
    <tr>
      <th>Beta2GP1</th>
      <td>0.000</td>
      <td>-0.490</td>
      <td>0.309</td>
      <td>-1.095, 0.114</td>
    </tr>
    <tr>
      <th>C1q</th>
      <td>0.000</td>
      <td>-0.462</td>
      <td>0.425</td>
      <td>-1.294, 0.37</td>
    </tr>
    <tr>
      <th>C3b</th>
      <td>0.000</td>
      <td>-0.945</td>
      <td>0.456</td>
      <td>-1.838, -0.051</td>
    </tr>
    <tr>
      <th>Cardiolipin</th>
      <td>0.000</td>
      <td>-0.256</td>
      <td>0.286</td>
      <td>-0.816, 0.305</td>
    </tr>
    <tr>
      <th>CCP1arg</th>
      <td>-0.321</td>
      <td>-1.061</td>
      <td>0.446</td>
      <td>-1.936, -0.186</td>
    </tr>
    <tr>
      <th>CCP1cit</th>
      <td>0.000</td>
      <td>0.141</td>
      <td>0.515</td>
      <td>-0.869, 1.15</td>
    </tr>
    <tr>
      <th>CENP</th>
      <td>0.000</td>
      <td>-0.128</td>
      <td>0.269</td>
      <td>-0.655, 0.399</td>
    </tr>
    <tr>
      <th>CMV</th>
      <td>0.000</td>
      <td>-0.230</td>
      <td>0.295</td>
      <td>-0.807, 0.348</td>
    </tr>
    <tr>
      <th>CollagenII</th>
      <td>0.000</td>
      <td>0.742</td>
      <td>0.326</td>
      <td>0.103, 1.381</td>
    </tr>
    <tr>
      <th>CpGmot</th>
      <td>0.000</td>
      <td>0.002</td>
      <td>0.711</td>
      <td>-1.392, 1.395</td>
    </tr>
    <tr>
      <th>CRP1</th>
      <td>0.000</td>
      <td>0.350</td>
      <td>0.441</td>
      <td>-0.513, 1.214</td>
    </tr>
    <tr>
      <th>DFS70</th>
      <td>0.000</td>
      <td>-0.120</td>
      <td>0.341</td>
      <td>-0.788, 0.548</td>
    </tr>
    <tr>
      <th>dsDNA2</th>
      <td>1.113</td>
      <td>5.374</td>
      <td>1.051</td>
      <td>3.315, 7.433</td>
    </tr>
    <tr>
      <th>Enolasearg</th>
      <td>0.000</td>
      <td>0.592</td>
      <td>0.370</td>
      <td>-0.134, 1.317</td>
    </tr>
    <tr>
      <th>Enolasecit</th>
      <td>0.000</td>
      <td>-0.557</td>
      <td>0.569</td>
      <td>-1.672, 0.558</td>
    </tr>
    <tr>
      <th>EphB2</th>
      <td>0.000</td>
      <td>-0.010</td>
      <td>0.391</td>
      <td>-0.777, 0.756</td>
    </tr>
    <tr>
      <th>FcER</th>
      <td>0.000</td>
      <td>0.150</td>
      <td>0.294</td>
      <td>-0.427, 0.727</td>
    </tr>
    <tr>
      <th>Fibrillarin</th>
      <td>0.000</td>
      <td>-0.281</td>
      <td>0.306</td>
      <td>-0.88, 0.319</td>
    </tr>
    <tr>
      <th>Ficolin</th>
      <td>0.000</td>
      <td>0.827</td>
      <td>0.368</td>
      <td>0.105, 1.548</td>
    </tr>
    <tr>
      <th>GAPDH</th>
      <td>0.000</td>
      <td>-0.323</td>
      <td>0.321</td>
      <td>-0.951, 0.306</td>
    </tr>
    <tr>
      <th>GBM</th>
      <td>-0.257</td>
      <td>-1.211</td>
      <td>0.378</td>
      <td>-1.951, -0.47</td>
    </tr>
    <tr>
      <th>H2Bp</th>
      <td>0.000</td>
      <td>0.558</td>
      <td>0.548</td>
      <td>-0.516, 1.633</td>
    </tr>
    <tr>
      <th>H2Bpac</th>
      <td>0.000</td>
      <td>0.036</td>
      <td>0.509</td>
      <td>-0.962, 1.035</td>
    </tr>
    <tr>
      <th>H4p</th>
      <td>0.000</td>
      <td>-1.039</td>
      <td>0.481</td>
      <td>-1.981, -0.097</td>
    </tr>
    <tr>
      <th>H4pac</th>
      <td>0.000</td>
      <td>0.182</td>
      <td>0.369</td>
      <td>-0.54, 0.905</td>
    </tr>
    <tr>
      <th>Histones</th>
      <td>-0.437</td>
      <td>-2.003</td>
      <td>0.514</td>
      <td>-3.011, -0.996</td>
    </tr>
    <tr>
      <th>IFNLambda</th>
      <td>0.000</td>
      <td>0.555</td>
      <td>0.336</td>
      <td>-0.104, 1.214</td>
    </tr>
    <tr>
      <th>IFNOmega</th>
      <td>0.000</td>
      <td>0.253</td>
      <td>0.269</td>
      <td>-0.274, 0.781</td>
    </tr>
    <tr>
      <th>Jo1</th>
      <td>0.000</td>
      <td>-0.069</td>
      <td>0.352</td>
      <td>-0.758, 0.621</td>
    </tr>
    <tr>
      <th>Ku</th>
      <td>0.000</td>
      <td>-0.334</td>
      <td>0.353</td>
      <td>-1.027, 0.359</td>
    </tr>
    <tr>
      <th>LaSSB</th>
      <td>0.434</td>
      <td>2.333</td>
      <td>0.495</td>
      <td>1.363, 3.303</td>
    </tr>
    <tr>
      <th>MBL2</th>
      <td>0.000</td>
      <td>0.065</td>
      <td>0.318</td>
      <td>-0.559, 0.689</td>
    </tr>
    <tr>
      <th>Mi2</th>
      <td>0.000</td>
      <td>0.244</td>
      <td>0.320</td>
      <td>-0.384, 0.872</td>
    </tr>
    <tr>
      <th>Nucleosome</th>
      <td>0.000</td>
      <td>0.098</td>
      <td>0.619</td>
      <td>-1.116, 1.312</td>
    </tr>
    <tr>
      <th>PCNA</th>
      <td>0.000</td>
      <td>-0.129</td>
      <td>0.498</td>
      <td>-1.105, 0.847</td>
    </tr>
    <tr>
      <th>Pentraxin3</th>
      <td>0.064</td>
      <td>1.023</td>
      <td>0.355</td>
      <td>0.328, 1.719</td>
    </tr>
    <tr>
      <th>PmScl100</th>
      <td>0.017</td>
      <td>0.121</td>
      <td>0.286</td>
      <td>-0.439, 0.681</td>
    </tr>
    <tr>
      <th>RA33</th>
      <td>0.000</td>
      <td>1.141</td>
      <td>0.439</td>
      <td>0.281, 2.0</td>
    </tr>
    <tr>
      <th>RipP0</th>
      <td>0.000</td>
      <td>0.065</td>
      <td>0.446</td>
      <td>-0.809, 0.938</td>
    </tr>
    <tr>
      <th>RipP0peptide</th>
      <td>-0.469</td>
      <td>-2.994</td>
      <td>0.597</td>
      <td>-4.164, -1.825</td>
    </tr>
    <tr>
      <th>RipP1</th>
      <td>0.000</td>
      <td>0.444</td>
      <td>0.678</td>
      <td>-0.886, 1.773</td>
    </tr>
    <tr>
      <th>RipP2</th>
      <td>0.074</td>
      <td>1.580</td>
      <td>0.566</td>
      <td>0.47, 2.689</td>
    </tr>
    <tr>
      <th>RNAPolIII</th>
      <td>0.000</td>
      <td>-0.059</td>
      <td>0.302</td>
      <td>-0.651, 0.534</td>
    </tr>
    <tr>
      <th>RNP70</th>
      <td>0.000</td>
      <td>-0.470</td>
      <td>0.370</td>
      <td>-1.195, 0.255</td>
    </tr>
    <tr>
      <th>RNPA</th>
      <td>0.060</td>
      <td>0.404</td>
      <td>0.294</td>
      <td>-0.173, 0.981</td>
    </tr>
    <tr>
      <th>RNPC</th>
      <td>0.000</td>
      <td>-0.015</td>
      <td>0.350</td>
      <td>-0.7, 0.67</td>
    </tr>
    <tr>
      <th>Ro52</th>
      <td>0.278</td>
      <td>0.961</td>
      <td>0.478</td>
      <td>0.025, 1.897</td>
    </tr>
    <tr>
      <th>Ro60</th>
      <td>1.093</td>
      <td>2.290</td>
      <td>0.535</td>
      <td>1.241, 3.338</td>
    </tr>
    <tr>
      <th>RPP25ThTo</th>
      <td>0.000</td>
      <td>-0.314</td>
      <td>0.247</td>
      <td>-0.798, 0.171</td>
    </tr>
    <tr>
      <th>Scl70</th>
      <td>0.000</td>
      <td>-0.965</td>
      <td>0.345</td>
      <td>-1.641, -0.29</td>
    </tr>
    <tr>
      <th>SmBB</th>
      <td>0.482</td>
      <td>1.264</td>
      <td>0.421</td>
      <td>0.438, 2.089</td>
    </tr>
    <tr>
      <th>SMP</th>
      <td>0.000</td>
      <td>-0.776</td>
      <td>0.336</td>
      <td>-1.436, -0.117</td>
    </tr>
    <tr>
      <th>TIF1gamma</th>
      <td>0.194</td>
      <td>0.788</td>
      <td>0.352</td>
      <td>0.098, 1.479</td>
    </tr>
    <tr>
      <th>TPO</th>
      <td>0.000</td>
      <td>0.357</td>
      <td>0.277</td>
      <td>-0.185, 0.899</td>
    </tr>
    <tr>
      <th>tTG</th>
      <td>-0.613</td>
      <td>-1.854</td>
      <td>0.399</td>
      <td>-2.636, -1.073</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>sns.reset_defaults()</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>pal <span class="op">=</span> sns.diverging_palette(<span class="dv">250</span>, <span class="dv">15</span>, s<span class="op">=</span><span class="dv">75</span>, l<span class="op">=</span><span class="dv">40</span>, center<span class="op">=</span><span class="st">"dark"</span>, as_cmap<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sns.plotting_context(<span class="st">"paper"</span>):</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> sns.axes_style(<span class="st">"whitegrid"</span>):</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="fl">2.5</span>, <span class="fl">2.5</span>))</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        g <span class="op">=</span> sns.scatterplot(y<span class="op">=</span>coefs_final.index, x<span class="op">=</span>coefs_final.values, </span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>                            hue<span class="op">=</span>coefs_final.values, palette<span class="op">=</span>pal, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        ax.<span class="bu">set</span>(title<span class="op">=</span><span class="st">'SLE vs. BBD'</span>,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>               xticks<span class="op">=</span>np.linspace(<span class="op">-</span><span class="fl">1.0</span>,<span class="fl">1.0</span>,<span class="dv">5</span>), xlim<span class="op">=</span>[<span class="op">-</span><span class="fl">1.2</span>,<span class="fl">1.2</span>], xlabel<span class="op">=</span><span class="vs">r'$\beta$'</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        sns.despine(fig<span class="op">=</span>fig,ax<span class="op">=</span>ax, left<span class="op">=</span><span class="va">True</span>, bottom<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">#fig.savefig('coefs_SLE_BBD.png', bbox_inches='tight', dpi=300, transparent=True)</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">#fig.savefig('coefs_SLE_BBD.pdf', bbox_inches='tight', transparent=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Plot cross-validated ROC:</p>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>sns.reset_defaults()</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sns.plotting_context(<span class="st">"paper"</span>):</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="fl">4.5</span>, <span class="fl">4.5</span>))</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    tprs, aucs <span class="op">=</span> calc_roc_cv(search_lasso.best_estimator_,cv,Xp1,y)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plot_roc_cv(tprs, aucs, fig, ax, fig_title<span class="op">=</span><span class="st">'SLE vs. BBD'</span>, line_color<span class="op">=</span><span class="st">'#CC79A7'</span>, legend_label<span class="op">=</span><span class="st">'LASSO'</span>)</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    tprs, aucs <span class="op">=</span> calc_roc_cv(lr_dsDNA,cv,dsDNA,y)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plot_roc_cv(tprs, aucs, fig, ax, reuse<span class="op">=</span><span class="va">True</span>, line_color<span class="op">=</span><span class="st">'gray'</span>, legend_label<span class="op">=</span><span class="st">'dsDNA only'</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>    sns.despine(fig<span class="op">=</span>fig,ax<span class="op">=</span>ax, trim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>    plt.legend(frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fig.savefig('roc_SLE_BBD.png', bbox_inches='tight', dpi=300, transparent=True)</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#fig.savefig('roc_SLE_BBD.pdf', bbox_inches='tight', dpi=300, transparent=True)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="stability-selection" class="level4">
<h4 class="anchored" data-anchor-id="stability-selection">Stability selection</h4>
<p>If we pick a certain lambda value, the features that get included might vary with a different dataset. We can estimate that variability by taking bootstrap samples of the dataset. Then we can select the features that are included most often</p>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>selector <span class="op">=</span> StabilitySelection(base_estimator<span class="op">=</span>pipe, lambda_name<span class="op">=</span><span class="st">'clf__C'</span>,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                                  lambda_grid<span class="op">=</span>Cs_lasso[np.argmax(search_lasso.cv_results_[<span class="st">"mean_test_score"</span>]):], <span class="co">#range from highest scoring lambda to lambda_max</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                                  random_state<span class="op">=</span><span class="dv">40</span>) </span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>selector.fit(Xp1, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 7min 37s, sys: 0 ns, total: 7min 37s
Wall time: 7min 37s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>StabilitySelection(base_estimator=Pipeline(steps=[('trf',
                                                   PowerTransformer(method='box-cox')),
                                                  ('clf',
                                                   LogisticRegression(max_iter=10000,
                                                                      penalty='l1',
                                                                      solver='liblinear'))]),
                   lambda_grid=array([0.13820433, 0.12888982, 0.12020308, 0.11210179, 0.10454651,
       0.09750042, 0.09092922, 0.08480089, 0.0790856 , 0.07375549,
       0.06878462, 0.06414877, 0.05982535, 0.05579333, 0.052033...
       0.0241516 , 0.02252386, 0.02100583, 0.01959011, 0.0182698 ,
       0.01703848, 0.01589014, 0.0148192 , 0.01382043, 0.01288898,
       0.01202031, 0.01121018, 0.01045465, 0.00975004, 0.00909292,
       0.00848009, 0.00790856, 0.00737555, 0.00687846, 0.00641488,
       0.00598254, 0.00557933, 0.0052033 , 0.00485262, 0.00452557,
       0.00422056, 0.00393611, 0.00367083, 0.00342343]),
                   lambda_name='clf__C', random_state=40)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>thresh <span class="op">=</span> <span class="fl">.45</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>plot_stability_path(selector, threshold_highlight<span class="op">=</span>thresh)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<pre><code>(&lt;Figure size 640x480 with 1 Axes&gt;,
 &lt;matplotlib.axes._subplots.AxesSubplot at 0x7fecdb511e10&gt;)</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>selector.set_params(threshold<span class="op">=</span>thresh)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>selected_variables <span class="op">=</span> selector.get_support(indices<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>selected_scores <span class="op">=</span> selector.stability_scores_.<span class="bu">max</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({<span class="st">'Variable'</span>: Xp1.columns[selected_variables], </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Stability score'</span>: selected_scores[selected_variables]}).sort_values(by<span class="op">=</span><span class="st">'Stability score'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Variable</th>
      <th>Stability score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CCP1arg</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>dsDNA2</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Histones</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>4</th>
      <td>LaSSB</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>7</th>
      <td>RipP0peptide</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Ro60</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>12</th>
      <td>SmBB</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>14</th>
      <td>tTG</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>GBM</td>
      <td>0.99</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Ro52</td>
      <td>0.98</td>
    </tr>
    <tr>
      <th>13</th>
      <td>TIF1gamma</td>
      <td>0.96</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Pentraxin3</td>
      <td>0.82</td>
    </tr>
    <tr>
      <th>8</th>
      <td>RipP2</td>
      <td>0.69</td>
    </tr>
    <tr>
      <th>9</th>
      <td>RNPA</td>
      <td>0.60</td>
    </tr>
    <tr>
      <th>6</th>
      <td>PmScl100</td>
      <td>0.47</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This overlaps completely with the LASSO model fit on the whole dataset</p>
</section>
<section id="test-on-other-groups-1" class="level4">
<h4 class="anchored" data-anchor-id="test-on-other-groups-1">Test on other groups</h4>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">pre-SLE (vs.&nbsp;rest)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">LLD (vs.&nbsp;rest)</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">IMID (vs.&nbsp;nonIMID)</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(X_test_df, <span class="st">'preSLE'</span>, <span class="st">'rest_large'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>eval_model(search_lasso, X_test<span class="op">+</span><span class="dv">1</span>, y_test, <span class="st">'preSLE'</span>, <span class="st">'rest_large'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

  rest_large       0.96      0.23      0.36       462
      preSLE       0.04      0.76      0.07        17

    accuracy                           0.24       479
   macro avg       0.50      0.49      0.22       479
weighted avg       0.93      0.24      0.35       479

N.B.: "recall" = sensitivity for the group in this row (e.g. preSLE); specificity for the other group (rest_large)
N.B.: "precision" = PPV for the group in this row (e.g. preSLE); NPV for the other group (rest_large)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-71-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-71-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Sensitivity is a bit better than when only using dsDNA, but everything else is worse</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(X_test_df, <span class="st">'LLD'</span>, <span class="st">'rest_large'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>eval_model(search_lasso, X_test<span class="op">+</span><span class="dv">1</span>, y_test, <span class="st">'LLD'</span>, <span class="st">'rest_large'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

  rest_large       0.95      0.23      0.36       462
         LLD       0.06      0.82      0.11        28

    accuracy                           0.26       490
   macro avg       0.51      0.52      0.24       490
weighted avg       0.90      0.26      0.35       490

N.B.: "recall" = sensitivity for the group in this row (e.g. LLD); specificity for the other group (rest_large)
N.B.: "precision" = PPV for the group in this row (e.g. LLD); NPV for the other group (rest_large)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-72-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-72-output-3.png" class="img-fluid"></p>
</div>
</div>
<p>Similar to preSLE. Seems that when trained on blood bank controls, model classifies everyone as a patient</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>X_test, y_test <span class="op">=</span> prep_data(data_all, <span class="st">'IMID'</span>, <span class="st">'nonIMID'</span>, [<span class="st">"Arthritis"</span>,<span class="st">"Pleurisy"</span>,<span class="st">"Pericarditis"</span>,<span class="st">"Nefritis"</span>] <span class="op">+</span> [<span class="st">"dsDNA1"</span>])</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>eval_model(search_lasso, X_test<span class="op">+</span><span class="dv">1</span>, y_test, <span class="st">'IMID'</span>, <span class="st">'nonIMID'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Threshold for classification: 0.5
              precision    recall  f1-score   support

     nonIMID       0.49      0.21      0.29       218
        IMID       0.63      0.86      0.73       346

    accuracy                           0.61       564
   macro avg       0.56      0.54      0.51       564
weighted avg       0.58      0.61      0.56       564

N.B.: "recall" = sensitivity for the group in this row (e.g. IMID); specificity for the other group (nonIMID)
N.B.: "precision" = PPV for the group in this row (e.g. IMID); NPV for the other group (nonIMID)
</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-73-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-73-output-3.png" class="img-fluid"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="elastic-net" class="level3">
<h3 class="anchored" data-anchor-id="elastic-net">Elastic net</h3>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>clf_enet <span class="op">=</span> LogisticRegression(penalty<span class="op">=</span><span class="st">'elasticnet'</span>, max_iter <span class="op">=</span> <span class="dv">10000</span>, solver <span class="op">=</span> <span class="st">'saga'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>Cs <span class="op">=</span> <span class="dv">1</span><span class="op">/</span>np.logspace(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">20</span>) <span class="co"># C is inverse of lambda</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>l1l2 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">10</span>) <span class="co"># 0 = l2 only; 1 = l1 only</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'trf'</span>, trf),</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf_enet)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [{</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__C"</span>: Cs,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__l1_ratio"</span>: l1l2</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>search_enet <span class="op">=</span> GridSearchCV(pipe, params, cv <span class="op">=</span> cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> parallel_backend(<span class="st">'threading'</span>):</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    search_enet.fit(Xp1,y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 1h 40min 45s, sys: 45min 40s, total: 2h 26min 25s
Wall time: 32min</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>search_enet.best_params_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>{'clf__C': 0.16237767391887226, 'clf__l1_ratio': 0.7777777777777777}</code></pre>
</div>
</div>
<p>So the best model tends to favor L1 more than L2, and has a similar lambda value compared to pure L1/L2</p>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>search_enet.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>0.9833992316750093</code></pre>
</div>
</div>
<p>AUC is a bit higher, but similar to LASSO</p>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get coefficients for each C/l1_ratio</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>coefs_enet <span class="op">=</span> np.empty([<span class="bu">len</span>(Cs), <span class="bu">len</span>(l1l2), <span class="bu">len</span>(X.columns)])</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,c <span class="kw">in</span> <span class="bu">enumerate</span>(Cs):</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j,l <span class="kw">in</span> <span class="bu">enumerate</span>(l1l2):</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>        clf_enet.set_params(C<span class="op">=</span>c, l1_ratio <span class="op">=</span> l, warm_start<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>        clf_enet.fit(X_trf,y)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>        coefs_enet[i,j,:] <span class="op">=</span> clf_enet.coef_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot AUC and n_features for different lambdas</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> search_enet.cv_results_[<span class="st">"mean_test_score"</span>].reshape(<span class="bu">len</span>(Cs),<span class="bu">len</span>(l1l2))</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>lines <span class="op">=</span> plt.plot(<span class="dv">1</span><span class="op">/</span>Cs, scores)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>plt.legend(lines, np.<span class="bu">round</span>(l1l2,<span class="dv">2</span>))</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">1e0</span>, <span class="fl">1e3</span>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>plt.ylim([<span class="fl">0.97</span>, <span class="fl">.99</span>])</span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Lambda'</span>)</span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'ROC AUC'</span>)</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Performance as a function of (Elastic net) regularization'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>Text(0.5, 1.0, 'Performance as a function of (Elastic net) regularization')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="SLE%20Versus%20BBD_files/figure-html/cell-79-output-2.png" class="img-fluid"></p>
</div>
</div>
<p>Here 0 = Ridge; 1 = LASSO. Max performance is very similar to pure LASSO, but with stronger regularization the hybrid models start to do a little better than pure Ridge or LASSO (but this is a small difference; note the scaling!)</p>
<div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(np.<span class="bu">abs</span>(coefs_enet[Cs <span class="op">==</span> search_enet.best_params_[<span class="st">"clf__C"</span>], l1l2 <span class="op">==</span> search_enet.best_params_[<span class="st">"clf__l1_ratio"</span>],:]) <span class="op">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>29</code></pre>
</div>
</div>
<p>The best model retains 29 features</p>
</section>
<section id="huber" class="level3">
<h3 class="anchored" data-anchor-id="huber">Huber</h3>
<div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>clf_huber <span class="op">=</span> SGDClassifier(loss <span class="op">=</span> <span class="st">'modified_huber'</span>, penalty<span class="op">=</span><span class="st">'elasticnet'</span>, max_iter <span class="op">=</span> <span class="dv">10000</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> np.logspace(<span class="op">-</span><span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">20</span>) <span class="co"># regularization strength</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>l1l2 <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">10</span>) <span class="co"># 0 = l2 only; 1 = l1 only</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline([</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'trf'</span>, trf),</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'clf'</span>, clf_huber)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> [{</span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__alpha"</span>: alpha,</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"clf__l1_ratio"</span>: l1l2</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>}]</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>search_huber <span class="op">=</span> GridSearchCV(pipe, params, cv <span class="op">=</span> cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>search_huber.fit(Xp1, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CPU times: user 17min 55s, sys: 35min 56s, total: 53min 52s
Wall time: 10min 27s</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="79">
<pre><code>GridSearchCV(cv=RepeatedStratifiedKFold(n_repeats=5, n_splits=5, random_state=40),
             estimator=Pipeline(steps=[('trf',
                                        PowerTransformer(method='box-cox')),
                                       ('clf',
                                        SGDClassifier(loss='modified_huber',
                                                      max_iter=10000,
                                                      penalty='elasticnet'))]),
             param_grid=[{'clf__alpha': array([1.00000000e-03, 2.06913808e-03, 4.28133240e-03, 8.85866790e-03,
       1.83298071e-02, 3.79269019....84759970e-02, 1.62377674e-01,
       3.35981829e-01, 6.95192796e-01, 1.43844989e+00, 2.97635144e+00,
       6.15848211e+00, 1.27427499e+01, 2.63665090e+01, 5.45559478e+01,
       1.12883789e+02, 2.33572147e+02, 4.83293024e+02, 1.00000000e+03]),
                          'clf__l1_ratio': array([0.        , 0.11111111, 0.22222222, 0.33333333, 0.44444444,
       0.55555556, 0.66666667, 0.77777778, 0.88888889, 1.        ])}],
             scoring='roc_auc')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>search_huber.best_score_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>0.9833815845219601</code></pre>
</div>
</div>
<p>This is very comparable to LASSO / elastic net</p>
</section>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>clf_rf <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>np.mean(cross_val_score(clf_rf, X, y, cv<span class="op">=</span>cv, scoring <span class="op">=</span> <span class="st">'roc_auc'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="81">
<pre><code>0.9912558838826646</code></pre>
</div>
</div>
<p>Completely untuned random forest with no feature preprocessing does even better still, but the increase in AUC is not worth the decrease in interpretability… Note though that this performs even a bit better than the (extensively tuned) XGBoost!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://github.com/umcu/SLE-autoantibody-prediction/blob/main/LICENSE">Copyright 2022, UMC Utrecht (MIT License)</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.umcutrecht.nl">
      <i class="bi bi-link" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/umcu">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/UMCU_Intl">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>